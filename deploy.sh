#!/bin/bash

# üöÄ –°–∫—Ä–∏–ø—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è Elena WhatsApp Bot –Ω–∞ Railway

echo "ü§ñ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Elena WhatsApp Bot –Ω–∞ Railway"
echo "================================================"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è Railway CLI
if ! command -v railway &> /dev/null; then
    echo "‚ùå Railway CLI –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Railway CLI..."
    npm install -g @railway/cli
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ Railway
if ! railway whoami &> /dev/null; then
    echo "üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ Railway..."
    railway login
fi

# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ Railway
echo "üèóÔ∏è –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ Railway..."
railway init

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
echo "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
railway variables set TWILIO_ACCOUNT_SID="$TWILIO_ACCOUNT_SID"
railway variables set TWILIO_AUTH_TOKEN="$TWILIO_AUTH_TOKEN"
railway variables set TWILIO_PHONE_NUMBER="$TWILIO_PHONE_NUMBER"
railway variables set OPENAI_API_KEY="$OPENAI_API_KEY"

# –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
echo "üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
railway up

# –ü–æ–ª—É—á–µ–Ω–∏–µ URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
echo "üåê –ü–æ–ª—É—á–µ–Ω–∏–µ URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
APP_URL=$(railway status --json | jq -r '.url')

echo "‚úÖ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
echo "üåê URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: $APP_URL"
echo "üîó Webhook URL: $APP_URL/webhook"
echo ""
echo "üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
echo "1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook –≤ Twilio Console: $APP_URL/webhook"
echo "2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –±–æ—Ç–∞: $APP_URL/health"
echo "3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: railway logs" 